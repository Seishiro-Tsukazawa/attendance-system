# bc7b25e版 UXレビュー

このドキュメントはコミット `bc7b25e` 時点のUI/UXを観察し、改善余地と具体策をまとめたものです。スマートフォンでの打刻を主目的に、PCでも管理がしやすいことを前提に評価しています。

## 現状の良い点
- ログイン〜打刻までの導線が1画面に収まっており、主要ボタンのサイズも十分でタップしやすい。
- ブランドカラー（青・緑・黄・赤）が一貫しており、シフト種別やボタンの意味が色で直感的に伝わる。【F:index.html†L274-L312】
- ナビゲーションは横スクロールでタブ化されており、機能が増えても画面幅を圧迫しない。【F:index.html†L223-L249】
- ダッシュボードや勤怠一覧に、フィルターやサマリーを備えており、管理者作業も1画面で完結しやすい。

## 改善が望まれる点と提案
### 1. ログイン体験（再訪ユーザーの時短）
- **観察**: 社員番号入力欄はバリデーションの補助文があるが、前回利用した番号の自動入力や貼り付け検知がなく、再ログイン時に毎回入力が必要。【F:index.html†L151-L176】
- **提案**: ローカルストレージに直近の成功ログイン番号を保存し、初期値として投入するトグル（「前回の番号を使う」チェックボックス）を標準表示する。貼り付け時に自動で全選択→貼り付けできるよう `input` イベントで長さチェックを行う。

### 2. 現在ビューの手がかり不足
- **観察**: タブのアクティブ状態は色のみで示され、スクロールでタブが部分的に隠れると現在地が分かりにくい。ダッシュボードや勤怠一覧が頻繁に行き来されるため迷いやすい。【F:index.html†L223-L249】
- **提案**: ヘッダー右上に「現在: ○○ビュー」の小さなテキストバッジを表示し、アクティブタブの下線を太くする。モバイルではタブバーをステッキー化し、左右端にグラデーションフェードを入れてスクロール可能であることを示す。

### 3. 打刻前の確認と誤タップ防止
- **観察**: シフト選択と打刻ボタンが物理的に離れており、現在の選択・前回の打刻状況が一目で分からないまま「出勤」「退勤」を押せる。【F:index.html†L264-L313】
- **提案**: 打刻ボタン押下時にシフト・時刻プレビューを表示するシートを追加し、「休憩自動控除後の概算勤務時間」を即時表示する。退勤ボタンは「出勤済み」状態でのみフルカラーにし、未打刻時はグレーアウト＋ツールチップで理由を示す。

#### 3-0. 打刻フロー全体のガード設計
- **目的**: 「意図したシフトで正しい順序の打刻を行う」ことをUIとバリデーションの両面で担保する。
- **UIフロー**: 
  1. シフト選択後、出勤ボタンが活性化し、押下で確認シートがスライドアップ。
  2. 確認シートに「選択シフト」「予定勤務」「現在時刻」「休憩自動控除後の見込み勤務」を表示し、`キャンセル` と `打刻する` の2択を提示。
  3. 出勤済みでない場合、退勤ボタンは `disabled` 表示＋「出勤が必要です」ツールチップ。出勤済みになるとフルカラー化。
  4. 退勤押下も同様に確認シートを経由し、最終勤務時間と差分（予定比±hh:mm）を表示。
- **バリデーション**: クライアント側で入力済みチェック（シフト、位置情報が必要なら取得成功）を行い、失敗時はシート上でエラーを表示。サーバーからのバリデーション結果（例: 二重打刻）も同じシートで示し、再試行導線を出す。
- **状態管理**: 出勤→退勤の状態は1画面のステータスバッジで可視化し、ローカル状態が不確実な場合（オフライン復帰直後など）は「同期待ち」バッジとローディングインジケーターを併記する。

#### 3-1. シフト未選択時は打刻を不可にする
- **目的**: シフト選択漏れによる誤打刻を防ぎ、勤務記録の整合性を高める。
- **UI挙動**: シフトラジオボタンの選択が無い場合は出勤・退勤ボタンを `disabled` にし、下部に「シフトを選んでから打刻してください」というアラートテキストを表示する。シフト選択後に初めて打刻ボタンが活性化するように状態管理を行う。【F:index.html†L274-L313】
- **確認導線**: 出勤押下後の確認シートに「選択シフト」「予定勤務時間」を明記し、変更したい場合の戻り導線を合わせて表示する。

#### 3-2. 出張シフトの追加と休日出勤併用の扱い
- **シフト候補**: 現状の「早番/遅番/休日出勤」に「出張」を追加し、視覚的に区別できる色（例: 紫系）を割り当てる。【F:index.html†L274-L313】
- **デフォルト時間**: 「出張」選択時はデフォルトで 8:30〜17:30 を予定勤務としてセットし、確認シートに明示する。
- **休日出勤×出張の両立**: 「出張」のチェックと別に「休日勤務」トグルを用意し、両方選ぶと勤務区分を「休日出張」として保存する。UI上はバッジの二重表示（例: 出張 + 休日）で状態を可視化し、休日扱いの計算ロジックが適用されることを示す。

#### 3-3. Supabase側の更新案
- **マスタ定義**: シフト種別を固定値で扱っている場合は `shift_type` カラムを ENUM からマスタテーブル参照型（例: `shift_types` テーブル）に変更し、「出張」を追加する。既存データへのマイグレーションでは、未指定値を既定の「早番/遅番/休日出勤」にマップする。
- **休日フラグ**: 休日出勤と出張の併用を表すために、勤怠レコードに `is_holiday_work` ブールと `shift_type_id`（出張含む）を併用するか、複数選択を許容する中間テーブル（`attendance_shift_tags`）を設ける。
- **デフォルト時間の保存**: 出張デフォルトの勤務開始・終了時刻をマスタに保持し、クライアントは初期表示時にその値を読み込む。ユーザーが変更した場合はレコード側に上書き保存し、マスタは参照用に残す。

### 4. 情報密度の最適化（モバイル）
- **観察**: 勤怠一覧やダッシュボードのテーブルは横スクロール前提で、主要指標と詳細が同じ優先度で並んでいるため、モバイルでの読み取り負荷が高い。【F:index.html†L324-L360】
- **提案**: モバイル幅では「出勤・退勤・勤務時間・シフト」の主要列のみ表示し、備考や振替などは「詳細を開く」アコーディオンに畳む。サマリーカードの上部に「現在の絞り込み条件（従業員・月）」を固定表示し、エクスポートでも同条件を明示する補足文を入れる。

### 5. 更新・同期ステータスの可視化
- **観察**: プルトゥリフレッシュインジケーターやヘッダーの更新ボタンはあるが、同期中・オフラインなどの状態表示はない。【F:index.html†L134-L213】
- **提案**: オフライン検知時にヘッダー直下へ「オフライン表示中／再接続で自動同期」のバナーを出し、更新ボタンに「最終同期: hh:mm」「未送信: n件」のバッジを表示する。PWAの更新が走った場合はスナックバーで「新しいバージョンを読み込み」導線を出す。

### 6. アクセスビリティ
- **観察**: 主要ボタンのサイズは十分だが、フォーカス可視化がTailwindのデフォルトに依存しており、キーボード操作時のアウトラインやARIA属性が限定的。
- **提案**: `aria-current="page"` をアクティブタブに付与し、キーボードフォーカスでのアウトラインカラーをブランド色に上書きする。モーダルや通知に `role="status"` を付け、読み上げ対応を強化する。

## まとめ
既存の色使いとレイアウトはわかりやすく、打刻の主導線もシンプルです。一方で「どこにいるか」「今どんな状態か」がテキストで示される場面が少なく、再訪ユーザーの時短や誤操作防止の余地があります。上記の改善により、モバイル中心の利用でも安心して操作できる体験に近づけられます。
